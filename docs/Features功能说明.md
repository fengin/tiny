# Tiny Framework 功能说明

## 1. 框架概述

Tiny Framework 是一个基于 Netty 的轻量级 Web 框架，专为物联网和边缘计算场景设计。框架具有以下特点：

- 轻量级：最小化依赖，启动快速，默认采用本地SQLite存储，资源占用少
- 高性能：基于 Netty 的异步非阻塞架构
- 易扩展：模块化设计，支持自定义扩展
- 双协议：同时支持 HTTP 和 TCP 协议
- 安全性：内置多重安全机制

## 2. 核心功能

### 2.1 HTTP 服务

- 支持 GET、POST、PUT、DELETE 等 HTTP 方法
- 灵活的路由配置和参数解析
  - 支持路径参数（如 /users/{id}）
  - 支持查询参数（如 ?page=1&size=10）
  - 支持通配符路由（如 /api/*）
- 请求体解析
  - application/x-www-form-urlencoded
  - multipart/form-data
  - application/json
  - application/xml
- 静态资源服务
  - 支持目录映射
  - 支持资源缓存
  - 支持 MIME 类型自动识别
- 响应处理
  - JSON 响应
  - 文件下载
  - 流式响应
  - CORS 支持
- 插件机制
  - 请求拦截
  - 响应处理
  - 异常处理
  - 安全过滤

### 2.2 TCP 服务

- 自定义消息协议
  - 消息头定义
  - 消息体格式
  - 校验机制
- 设备连接生命周期管理
  - 连接建立
  - 连接维护
  - 优雅关闭
- 心跳检测机制
  - 可配置心跳间隔检查
  - 自动断开超时连接
  - 心跳统计
- 消息编解码器
  - 支持多种编码格式
  - 消息分片处理
  - 粘包拆包处理
- 连接监控
  - 连接数统计
  - 流量监控
  - 延迟统计

### 2.3 配置管理

- 基于 YAML 的配置文件
  - 服务器配置
  - 连接池配置
  - 线程池配置
  - 日志配置
- 支持多环境配置
  - 开发环境
  - 测试环境
  - 生产环境
- 全局应用上下文
  - 配置信息
  - 运行时状态
  - 系统资源
- 安全配置
  - http授信静态资源访问
  - http跨域访问
  - 限流控制
  - 防DDOS攻击

### 2.6 安全机制

- 插件拦截验证
  - 用户认证
  - 系统认证
- 访问控制
  - 访问频率限制
  - 并发连接限制

### 2.7 监控管理

- 系统监控
  - http内存使用
- 连接监控
  - 连接数量
  - 连接状态

## 3. 技术特性

### 3.1 高性能设计

- 基于 Netty 的事件驱动模型
  - 异步非阻塞 I/O
  - 高效的事件循环
  - 零拷贝技术
  - 内存池管理
- 线程模型优化
  - 多线程处理
  - 线程池管理
  - 任务调度
  - 负载均衡
- 数据处理优化
  - 设备消息批量处理
  - 压缩传输
  - 缓存机制
  - 延迟处理

### 3.2 可靠性保障

- 设备心跳检测
  - 定时检测
  - 超时处理
  - 自动重连
- 设备连接状态管理
  - 状态监控
  - 异常检测
- 异常处理机制
  - 全局异常处理
  - 业务异常处理
- 优雅关闭
  - 资源释放
  - 连接关闭
  - 任务完成

### 3.3 安全特性

- 认证机制
  - 设备认证
  - 用户认证
  - Token 管理
- 访问控制
  - 权限验证
  - 访问限制 

## 4. 配置性能建议

#### 低并发场景（日活1000以下）

- 配置参数
  - bossThreads: 1
  - workerThreads: CPU核心数
  - backlog: 128
  - 业务线程池: 10-20
- 性能指标
  - 并发连接：< 1000
  - 消息处理：1000/s
  - 响应时间：< 50ms
  - 内存占用：< 256MB

#### 中等并发场景（日活1000-10000）

- 配置参数
  - bossThreads: 2
  - workerThreads: CPU核心数 * 2
  - backlog: 1024
  - 业务线程池: 20-50
- 性能指标
  - 并发连接：1000-5000
  - 消息处理：5000/s
  - 响应时间：< 100ms
  - 内存占用：512MB

#### 高并发场景（日活10000以上）

- 配置参数
  - bossThreads: 4
  - workerThreads: CPU核心数 * 4
  - backlog: 2048
  - 业务线程池: 50-200
- 性能指标
  - 并发连接：5000+
  - 消息处理：10000+/s
  - 响应时间：< 200ms
  - 内存占用：1GB+

## 5. 系统要求

### 5.1 运行环境

- Java 环境
  - JDK >=1.8
  - 推荐 JDK 17 LTS
- 操作系统
  - Windows 
  - Linux 
  - MacOS

### 5.2 依赖

- 核心依赖
  - netty-all
  - slf4j-api（jdk1.8用1.7.36，jdk17建议2.0.4）
  - logback-classic
  - sqlite-jdbc
  - jackson-databind
- 配置处理
  - snakeyaml: 1.x
- 工具库
  - lombok
- 测试
  - junit
  - mockito-core
